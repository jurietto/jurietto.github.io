<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Status Log</title>
  <link rel="stylesheet" href="../style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Redirect to frame.html if not inside iframe -->
  <script>
    if (window.top === window.self) {
      window.location.href = "/frame.html";
    }
  </script>
</head>
<body class="content-frame">

  <!-- Fallback player (only if user loads this page outside the frame) -->
  <div id="player-container"></div>

  <div class="main-content">
    <h1>Status Log</h1>

    <div id="last-updated">
      <p>Juri: Loading...</p>
    </div>

    <p class="page-text">
      A timeline of little updates, moods, and notes.
    </p>

    <p>
      <a href="/updates/updates.html" target="contentframe">
        <img src="/media/c6.gif" alt="parent directory icon" class="icon" />
        [parent directory]
      </a>
    </p>

    <div id="controls">
      <label for="sort">Sort by:</label>
      <select id="sort">
        <option value="new">Newest</option>
        <option value="old">Oldest</option>
      </select>
    </div>

    <div id="status-list">
      <p>Loading status updates...</p>
    </div>

    <div id="footer"></div>
  </div>

  <!-- JavaScript -->
  <script>
    fetch('statuslog.json')
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById('status-list');
        list.innerHTML = '';

        const entries = data.map(entry => {
          const div = document.createElement('div');
          div.className = 'post';
          div.dataset.time = entry.time;
          div.innerHTML = `
            <p class="commit-header">
              <img src="/media/crown.png" alt="update icon" class="icon" />
              <strong>${entry.author}</strong> â€“ <strong>${entry.time}</strong>
            </p>
            <p class="commit-message">${entry.text}</p>
            <hr />
          `;
          return div;
        });

        function render(order) {
          list.innerHTML = '';
          const sorted = [...entries].sort((a, b) => {
            const dateA = new Date(a.dataset.time);
            const dateB = new Date(b.dataset.time);
            return order === 'old' ? dateA - dateB : dateB - dateA;
          });
          sorted.forEach(e => list.appendChild(e));
        }

        render('new');
        document.getElementById('sort').addEventListener('change', e => render(e.target.value));

        const latest = data[data.length - 1];
        if (latest) {
          document.querySelector('#last-updated p').textContent = `Juri: ${latest.time}`;
        }
      })
      .catch(err => {
        document.getElementById('status-list').innerHTML =
          '<p style="color: crimson;">Could not load status entries.</p>';
        console.error(err);
      });

    // Load footer
    fetch('../footer.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('footer').innerHTML = html;
      });

    // Load fallback player only if not inside a frame
    if (window.top === window.self) {
      fetch('/player.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById('player-container').innerHTML = html;
          const script = document.createElement('script');
          script.src = '/player.js';
          script.defer = true;
          document.body.appendChild(script);
        });
    }
  </script>

  <script src="../script.js"></script>
</body>
</html>
