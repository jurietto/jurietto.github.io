<div class="main-content">
  <h1>Status Log</h1>

  <div id="last-updated">
    <p>Juri: Loading...</p>
  </div>

  <p class="page-text">
    A timeline of little updates, moods, and notes.
  </p>

  <p>
    <a href="/updates/updates.html">
      <img src="https://file.garden/ZhTgSjrp5nAroRKq/charmmy-6.gif" alt="Back icon" class="icon" />
      [parent directory]
    </a>
  </p>

  <div id="controls">
    <label for="sort">Sort by:</label>
    <select id="sort">
      <option value="new">Newest</option>
      <option value="old">Oldest</option>
    </select>
  </div>

  <div id="status-list">
    <p>Loading status updates...</p>
  </div>
</div>

<script>
  fetch('/updates/statuslog.json')
    .then(response => response.json())
    .then(data => {
      const list = document.getElementById('status-list');
      list.innerHTML = '';

      const entries = data.map(entry => {
        const dateFormatted = new Date(entry.time).toLocaleString(undefined, {
          dateStyle: 'long',
          timeStyle: 'short'
        });

        const div = document.createElement('div');
        div.className = 'post';
        div.dataset.time = entry.time;
        div.innerHTML = `
          <p class="commit-header">
            <img src="https://file.garden/ZhTgSjrp5nAroRKq/c0d36cbd.png" class="icon" alt="update icon" />
            <strong>${entry.author}</strong> â€“ <strong>${dateFormatted}</strong>
          </p>
          <p class="commit-message">${entry.text}</p>
          <hr />
        `;
        return div;
      });

      const sortSelect = document.getElementById('sort');

      function render(order) {
        list.innerHTML = '';
        const sorted = [...entries].sort((a, b) => {
          const dateA = new Date(a.dataset.time);
          const dateB = new Date(b.dataset.time);
          return order === 'old' ? dateA - dateB : dateB - dateA;
        });
        sorted.forEach(e => list.appendChild(e));
      }

      render('new');
      sortSelect.addEventListener('change', () => render(sortSelect.value));

      const latest = data.reduce((a, b) =>
        new Date(a.time) > new Date(b.time) ? a : b
      );
      if (latest) {
        const formatted = new Date(latest.time).toLocaleString(undefined, {
          dateStyle: 'long',
          timeStyle: 'short'
        });
        document.querySelector('#last-updated p').textContent = `Juri: ${formatted}`;
      }
    })
    .catch(err => {
      document.getElementById('status-list').innerHTML = '<p style="color: crimson;">Could not load status entries.</p>';
      document.querySelector('#last-updated p').textContent = 'Juri: Unavailable';
      console.error(err);
    });
</script>
