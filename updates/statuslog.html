<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Status Log</title>
  <link rel="stylesheet" href="../style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    #status-list hr {
      border: 0;
      border-bottom: 1px dotted #e79cff;
      margin: 12px 0;
    }
  </style>
</head>
<body>
  <div class="main-content">
    <h1>
      Status Log
      <img src="https://file.garden/ZhTgSjrp5nAroRKq/ckpxl.gif" alt="" class="icon-header" />
    </h1>

    <div id="last-updated">
      <p>
        <img src="https://file.garden/ZhTgSjrp5nAroRKq/charmmy-kitty-bullet-2.gif" alt="Charmmy Icon" class="icon-date" />
        Juri: Loading...
      </p>
    </div>

    <p class="page-text">
      A timeline of little updates, moods, and life notes. These status entries are kind of like micro-logs â€”  
      quick thoughts, reminders, or energy check-ins. Theyâ€™re mostly for me to reflect and track how Iâ€™ve been feeling,  
      but youâ€™re welcome to read along ðŸ’Œ
    </p>

    <p>
      <a href="/updates/updates.html">
        <img src="https://file.garden/ZhTgSjrp5nAroRKq/charmmy-6.gif" alt="Back icon" class="icon" />
        [parent directory]
      </a>
    </p>

    <!-- Controls block -->
    <div id="controls">
      <label for="sort">Sort by:</label>
      <select id="sort">
        <option value="new">Newest</option>
        <option value="old">Oldest</option>
      </select>
    </div>

    <div id="status-list">
      <p>Loading status updates...</p>
    </div>

    <div id="footer"></div>

    <script>
      fetch('statuslog.json')
        .then(response => response.json())
        .then(data => {
          const list = document.getElementById('status-list');
          list.innerHTML = '';

          // Convert entries to DOM elements
          const entries = data.map(entry => {
            const div = document.createElement('div');
            div.className = 'post';
            div.dataset.time = entry.time;
            div.innerHTML = `
              <p class="commit-header">
                <img src="https://file.garden/ZhTgSjrp5nAroRKq/charmmy-2.gif" alt="update icon" class="icon" />
                <strong>${entry.author}</strong> â€“ <strong>${entry.time}</strong>
              </p>
              <p class="commit-message">${entry.text}</p>
              <hr />
            `;
            return div;
          });

          const sortSelect = document.getElementById('sort');

          function render(order) {
            list.innerHTML = '';
            const sorted = [...entries].sort((a, b) => {
              const dateA = new Date(a.dataset.time);
              const dateB = new Date(b.dataset.time);
              return order === 'old' ? dateA - dateB : dateB - dateA;
            });
            sorted.forEach(e => list.appendChild(e));
          }

          render('new');
          sortSelect.addEventListener('change', () => render(sortSelect.value));

          // Update "Last Updated"
          const latest = data[data.length - 1];
          if (latest) {
            document.querySelector('#last-updated p').innerHTML = `
              <img src="https://file.garden/ZhTgSjrp5nAroRKq/51c0471f.gif" alt="Card Icon" class="icon" />
              Juri: ${latest.time}
            `;
          }
        })
        .catch(err => {
          document.getElementById('status-list').innerHTML = '<p style="color: crimson;">Could not load status entries.</p>';
          console.error(err);
        });

      fetch('../footer.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById('footer').innerHTML = html;
        });
    </script>

    <script src="../script.js"></script>
  </div>
</body>
</html>
