<div class="main-content">
  <h1>Life Updates</h1>

  <div id="last-updated">
    <p>Last Updated: Loading...</p>
  </div>

  <p class="page-text">
    A space where I post life stuff, events, and whatever’s been going on.
  </p>

  <p>
    <a href="/updates/updates.html">
      <img src="/media/c8.gif" alt="parent directory icon" class="icon" />
      [parent directory]
    </a>
  </p>

  <div id="controls">
    <label for="sort">Sort by:</label>
    <select id="sort">
      <option value="new">Newest</option>
      <option value="old">Oldest</option>
    </select>
  </div>

  <div id="lu-posts">
    <p>Loading life updates...</p>
  </div>
</div>

<style>
  #lu-posts hr {
    border: 0;
    border-bottom: 1px dotted #e79cff;
    margin: 12px 0;
  }
</style>

<script>
  // Load life update posts
  fetch('/updates/lu')
    .then(res => res.text())
    .then(html => {
      const postsContainer = document.getElementById('lu-posts');
      const tempContainer = document.createElement('div');
      tempContainer.innerHTML = html;

      const posts = Array.from(tempContainer.getElementsByClassName('post'));

      posts.forEach(post => {
        const dateText = post.querySelector('strong')?.textContent.split('–')[0]?.trim();
        post.setAttribute('data-date', dateText);
        postsContainer.appendChild(post);
        const hr = document.createElement('hr');
        postsContainer.appendChild(hr);
      });

      function sortPosts(order) {
        const postElements = Array.from(postsContainer.querySelectorAll('.post'));
        postElements.sort((a, b) => {
          const dateA = new Date(a.dataset.date);
          const dateB = new Date(b.dataset.date);
          return order === 'old' ? dateA - dateB : dateB - dateA;
        });

        postsContainer.innerHTML = '';
        postElements.forEach(post => {
          postsContainer.appendChild(post);
          const hr = document.createElement('hr');
          postsContainer.appendChild(hr);
        });
      }

      const sortSelect = document.getElementById('sort');
      sortPosts(sortSelect.value);
      sortSelect.addEventListener('change', () => sortPosts(sortSelect.value));
    })
    .catch(err => {
      console.error('Failed to load life updates:', err);
      document.getElementById('lu-posts').innerHTML = '<p>Could not load posts.</p>';
    });

  // Load Last Updated from meta
  fetch('/meta/lifeupdates_meta.json')
    .then(res => res.json())
    .then(data => {
      const lastDate = new Date(data.lastUpdated);
      const formatted = lastDate.toLocaleString(undefined, {
        dateStyle: 'long',
        timeStyle: 'short'
      });
      document.querySelector('#last-updated p').textContent = `Last Updated: ${formatted}`;
    })
    .catch(err => {
      console.error('Failed to load last updated metadata:', err);
      document.querySelector('#last-updated p').textContent = 'Last Updated: Unavailable';
    });
</script>
